var e=function(e,t){var a=this;"function"==typeof e&&(t=e,e={}),e=Object.assign({container:null,default:"light",toggle:null,remember:"darken-mode",usePrefersColorScheme:!0,class:"darken",stylesheets:{},timestamps:{},variables:{}},e),this.dark=!1;var r=new Date;e.remember?localStorage.getItem(e.remember)?e.default=localStorage.getItem(e.remember):e.usePrefersColorScheme?e.default=this.__checkMatchMedia()||e.default:Object.keys(e.timestamps).length>0&&e.timestamps.dark&&e.timestamps.light&&(e.default=this.__checkTimestamps(e,r)):e.usePrefersColorScheme?(e.default=this.__checkMatchMedia()||e.default,window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){e.matches&&a.on()}),window.matchMedia("(prefers-color-scheme: light)").addListener(function(e){e.matches&&a.off()})):Object.keys(e.timestamps).length>0&&e.timestamps.dark&&e.timestamps.light&&(e.default=this.__checkTimestamps(e,r)),e.toggle&&document.querySelector(e.toggle).addEventListener("click",this.__handleClick.bind(this)),document.addEventListener("darken-dark",this.__handleDarkenEvent(e,t,"add"),!1),document.addEventListener("darken-light",this.__handleDarkenEvent(e,t,"remove"),!1),"light"===e.default?this.off():"dark"===e.default&&this.on()};e.prototype.__handleDarkenEvent=function(e,t,a){var r=this;return function(){e.container?document.querySelector(e.container).classList[a](e.class):document.body.classList[a](e.class);for(var s=e.container?document.querySelector(e.container):document.documentElement,n=0,i=Object.entries(e.variables);n<i.length;n+=1){var o=i[n],d=o[0],c=o[1];c&&"object"==typeof c&&(Array.isArray(c)?s.style.setProperty(d,r.dark?c[1]:c[0]):s.style.setProperty(d,c[r.dark?"dark":"light"]))}r.__changeStylesheet(e.stylesheets.id,e.stylesheets[r.dark?"dark":"light"]),e.remember&&localStorage.setItem(e.remember,r.dark?"dark":"light"),"function"==typeof t&&t(r.dark)}},e.prototype.__handleClick=function(e){e.preventDefault(),this.toggle()},e.prototype.__checkMatchMedia=function(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":void 0},e.prototype.__normalizeTimestamps=function(e){for(var t=0,a=Object.entries(e);t<a.length;t+=1){var r=a[t],s=r[0],n=r[1],i=new Date,o=n.split(":");i.setHours(o[0],o[1],0,0),e[s]=i}},e.prototype.__changeStylesheet=function(e,t){var a=document.head.querySelector("#"+e||"#darken-stylesheet");a?t?a.href=t:document.head.removeChild(a):t&&((a=document.createElement("link")).id=e||"darken-stylesheet",a.rel="stylesheet",a.type="text/css",a.href=t,document.head.appendChild(a))},e.prototype.__checkTimestamps=function(e,t){return this.__normalizeTimestamps(e.timestamps),e.timestamps.dark<t&&t>e.timestamps.light||e.timestamps.dark>t&&t<e.timestamps.light?"dark":"light"},e.prototype.toggle=function(){this.dark=!this.dark,this.dark?document.dispatchEvent(new Event("darken-dark")):document.dispatchEvent(new Event("darken-light"))},e.prototype.on=function(){this.dark=!0,document.dispatchEvent(new Event("darken-dark"))},e.prototype.off=function(){this.dark=!1,document.dispatchEvent(new Event("darken-light"))},module.exports=e;
