!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Darken=t()}(this,(function(){"use strict";return class{constructor(e,t){"function"==typeof e&&(t=e,e={}),e=Object.assign({container:null,default:"light",toggle:null,remember:"darken-mode",usePrefersColorScheme:!0,class:"darken",stylesheets:{},timestamps:{},variables:{}},e),this.dark=!1;let s=new Date;e.remember?localStorage.getItem(e.remember)?e.default=localStorage.getItem(e.remember):e.usePrefersColorScheme?e.default=this.__checkMatchMedia()||e.default:Object.keys(e.timestamps).length>0&&e.timestamps.dark&&e.timestamps.light&&(e.default=this.__checkTimestamps(e,s)):e.usePrefersColorScheme?(e.default=this.__checkMatchMedia()||e.default,window.matchMedia("(prefers-color-scheme: dark)").addListener((e=>{e.matches&&this.on()})),window.matchMedia("(prefers-color-scheme: light)").addListener((e=>{e.matches&&this.off()}))):Object.keys(e.timestamps).length>0&&e.timestamps.dark&&e.timestamps.light&&(e.default=this.__checkTimestamps(e,s)),e.toggle&&document.querySelector(e.toggle).addEventListener("click",this.__handleClick.bind(this)),document.addEventListener("darken-dark",this.__handleDarkenEvent(e,t,"add"),!1),document.addEventListener("darken-light",this.__handleDarkenEvent(e,t,"remove"),!1),"light"===e.default?this.off():"dark"===e.default&&this.on()}__handleDarkenEvent(e,t,s){return()=>{e.container?document.querySelector(e.container).classList[s](e.class):document.body.classList[s](e.class);const a=e.container?document.querySelector(e.container):document.documentElement;for(let[t,s]of Object.entries(e.variables))s&&"object"==typeof s&&(Array.isArray(s)?a.style.setProperty(t,this.dark?s[1]:s[0]):a.style.setProperty(t,s[this.dark?"dark":"light"]));this.__changeStylesheet(e.stylesheets.id,e.stylesheets[this.dark?"dark":"light"]),e.remember&&localStorage.setItem(e.remember,this.dark?"dark":"light"),"function"==typeof t&&t(this.dark)}}__handleClick(e){e.preventDefault(),this.toggle()}__checkMatchMedia(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":void 0}__normalizeTimestamps(e){for(let[t,s]of Object.entries(e)){let a=new Date,r=s.split(":");a.setHours(r[0],r[1],0,0),e[t]=a}}__changeStylesheet(e,t){let s=document.head.querySelector("#"+e||"#darken-stylesheet");s?t?s.href=t:document.head.removeChild(s):t&&(s=document.createElement("link"),s.id=e||"darken-stylesheet",s.rel="stylesheet",s.type="text/css",s.href=t,document.head.appendChild(s))}__checkTimestamps(e,t){return this.__normalizeTimestamps(e.timestamps),e.timestamps.dark<t&&t>e.timestamps.light||e.timestamps.dark>t&&t<e.timestamps.light?"dark":"light"}toggle(){this.dark=!this.dark,this.dark?document.dispatchEvent(new Event("darken-dark")):document.dispatchEvent(new Event("darken-light"))}on(){this.dark=!0,document.dispatchEvent(new Event("darken-dark"))}off(){this.dark=!1,document.dispatchEvent(new Event("darken-light"))}}}));
